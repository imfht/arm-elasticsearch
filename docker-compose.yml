version: '3.5'

services:

  es_venus:
    image: jahrik/arm-elasticsearch:arm32v7
    ports:
      - "9200:9200"
    volumes:
      - /data:/var/lib/elasticsearch:rw
      - /etc/elasticsearch/elasticsearch.yml:/etc/elasticsearch/elasticsearch.yml
      - /etc/elasticsearch/jvm.options:/etc/elasticsearch/jvm.options
    networks:
      - traefik
      - elk
    deploy:
      labels:
        traefik.docker.network: traefik
        traefik.backend: es_venus
        traefik.port: 9200
        traefik.frontend.rule: Host:es_venus.homelab.business
        traefik.frontend.entryPoints: http
      placement:
        constraints:
          - node.labels.arch == arm32v7
          - node.hostname == venus

  es_ninja:
    image: jahrik/arm-elasticsearch:arm32v7
    volumes:
      - /data:/var/lib/elasticsearch:rw
      - /etc/elasticsearch/elasticsearch.yml:/etc/elasticsearch/elasticsearch.yml
      - /etc/elasticsearch/jvm.options:/etc/elasticsearch/jvm.options
    networks:
      - traefik
      - elk
    deploy:
      labels:
        traefik.docker.network: traefik
        traefik.backend: es_ninja
        traefik.port: 9200
        traefik.frontend.rule: Host:es_ninja.homelab.business
        traefik.frontend.entryPoints: http
      placement:
        constraints:
          - node.labels.arch == arm32v7
          - node.hostname == ninja

  es_oroku:
    image: jahrik/arm-elasticsearch:arm32v7
    volumes:
      - /data:/var/lib/elasticsearch:rw
      - /etc/elasticsearch/elasticsearch.yml:/etc/elasticsearch/elasticsearch.yml
      - /etc/elasticsearch/jvm.options:/etc/elasticsearch/jvm.options
    networks:
      - traefik
      - elk
    deploy:
      labels:
        traefik.docker.network: traefik
        traefik.backend: es_oroku
        traefik.port: 9200
        traefik.frontend.rule: Host:es_oroku.homelab.business
        traefik.frontend.entryPoints: http
      placement:
        constraints:
          - node.labels.arch == arm32v7
          - node.hostname == oroku

networks:
  traefik:
    driver: overlay
    external: true
  elk:
    name: elk
    driver: overlay
